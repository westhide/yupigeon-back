use sea_orm::entity::prelude::*;

use crate::mysql::entity::finance_kingdee_cloud_voucher_combine as KingdeeCloudVoucher;

pub async fn voucher_combine(operate_id: &str) -> Result<Vec<KingdeeCloudVoucher::Model>, DbErr> {
    let database = crate::mysql::Database::new("default").await?;
    database
        .find_by_sql_and_values(
            r#"
            SELECT
                CAST(0 AS UNSIGNED) id,
                operate_id,
                business_date,
                bookkeeping_date,
                company_finance_code,
                company_name,
                book_code,
                book_name,
                voucher_code,
                voucher_type,
                voucher_no,
                creator_code,
                creator_name,
                abstract,
                finance_account_code,
                finance_account_name,
                due_date,
                business_no,
                measure_unit_code,
                measure_unit_name,
                quantity,
                unit_price,
                currency_code,
                currency_name,
                SUM(debit_original_currency_amount) debit_original_currency_amount,
                SUM(credit_original_currency_amount) credit_original_currency_amount,
                currency_rate,
                SUM(debit_amount) debit_amount,
                SUM(credit_amount) credit_amount,
                cashflow_code,
                cashflow_name,
                cashflow_supplement_name,
                cashflow_amount,
                cashflow_supplement_code,
                cashflow_supplement_amount,
                assist_account_name1,
                assist_account_item_code1,
                assist_account_item_name1,
                assist_account_name2,
                assist_account_item_code2,
                assist_account_item_name2,
                assist_account_name3,
                assist_account_item_code3,
                assist_account_item_name3,
                assist_account_name4,
                assist_account_item_code4,
                assist_account_item_name4,
                assist_account_name5,
                assist_account_item_code5,
                assist_account_item_name5,
                cashflow_assist_account_name1,
                cashflow_assist_account_item_code1,
                cashflow_assist_account_item_name1,
                cashflow_assist_account_name2,
                cashflow_assist_account_item_code2,
                cashflow_assist_account_item_name2,
                cashflow_assist_account_name3,
                cashflow_assist_account_item_code3,
                cashflow_assist_account_item_name3,
                cashflow_assist_account_name4,
                cashflow_assist_account_item_code4,
                cashflow_assist_account_item_name4,
                cashflow_assist_account_name5,
                cashflow_assist_account_item_code5,
                cashflow_assist_account_item_name5
            FROM
                finance_kingdee_cloud_voucher_combine
            WHERE
                operate_id = ?
            GROUP BY
                operate_id,
                business_date,
                bookkeeping_date,
                company_finance_code,
                company_name,
                book_code,
                book_name,
                voucher_code,
                voucher_type,
                voucher_no,
                creator_code,
                creator_name,
                abstract,
                finance_account_code,
                finance_account_name,
                due_date,
                business_no,
                measure_unit_code,
                measure_unit_name,
                quantity,
                unit_price,
                currency_code,
                currency_name,
                currency_rate,
                cashflow_code,
                cashflow_name,
                cashflow_supplement_name,
                cashflow_amount,
                cashflow_supplement_code,
                cashflow_supplement_amount,
                assist_account_name1,
                assist_account_item_code1,
                assist_account_item_name1,
                assist_account_name2,
                assist_account_item_code2,
                assist_account_item_name2,
                assist_account_name3,
                assist_account_item_code3,
                assist_account_item_name3,
                assist_account_name4,
                assist_account_item_code4,
                assist_account_item_name4,
                assist_account_name5,
                assist_account_item_code5,
                assist_account_item_name5,
                cashflow_assist_account_name1,
                cashflow_assist_account_item_code1,
                cashflow_assist_account_item_name1,
                cashflow_assist_account_name2,
                cashflow_assist_account_item_code2,
                cashflow_assist_account_item_name2,
                cashflow_assist_account_name3,
                cashflow_assist_account_item_code3,
                cashflow_assist_account_item_name3,
                cashflow_assist_account_name4,
                cashflow_assist_account_item_code4,
                cashflow_assist_account_item_name4,
                cashflow_assist_account_name5,
                cashflow_assist_account_item_code5,
                cashflow_assist_account_item_name5
           "#,
            vec![operate_id.into()],
        )
        .await
}
